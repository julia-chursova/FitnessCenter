@model IEnumerable<FitnessCenter.Entities.TimetableItem>

@{
    ViewBag.Title = "Расписание";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@using FitnessCenter.Models

<h2>Расписание</h2>

<p>
    @Html.ActionLink("Создать", "Create")
</p>
<table class="table">
    @*<tr>
        <th>
            @Html.DisplayNameFor(model => model.RoomId)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.ActivityId)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.EmployeeId)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.EndTime)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.StartTime)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.DayOfWeek)
        </th>
        <th></th>
    </tr>*@

    <tr>
        <th>
            
        </th>
        <th>Понедельник</th>
        <th>Вторник</th>
        <th>Среда</th>
        <th>Четверг</th>
        <th>Пятница</th>
        <th>Суббота</th>
        <th>Воскресенье</th>
    </tr>

@for (int j = 0; j < (Model.Max(e => e.EndTime) - Model.Min(s => s.StartTime)).Hours + 1; j++ )
{
    @*<tr>
        <td>
            @Html.DisplayFor(modelItem => item.RoomId)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.ActivityId)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.EmployeeId)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.EndTime)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.StartTime)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.DayOfWeek)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Info)
        </td>
        <td>
            @Html.ActionLink("Edit", "Edit", new { id=item.Id }) |
            @Html.ActionLink("Details", "Details", new { id=item.Id }) |
            @Html.ActionLink("Delete", "Delete", new { id=item.Id })
        </td>
    </tr>*@
    
    <tr>
        <td>
           @{
               var t = new TimeSpan(j, 0, 0);
               var tt = t + Model.Min(s => s.StartTime);
               <p>@tt</p>
           }
        </td>
        <td>
            @{                
                var items = Model.Where(i => i.DayOfWeek == 1 && i.StartTime >= tt && i.StartTime < tt + new TimeSpan(1, 0, 0));
                foreach (var item in items)
                {
                    @Html.MyActonLink(item.Info, "Details", "Timetable", new { id = item.Id }, null);
                }
}
            @*@foreach (var item in @Model.Where(i => i.DayOfWeek == 1))
            {
                @Html.DisplayFor(modelItem => item.Activity.Name)
            }*@
        </td>
        <td>
            @{
                items = Model.Where(i => i.DayOfWeek == 2 && i.StartTime >= tt && i.StartTime < tt + new TimeSpan(1, 0, 0));
                foreach (var item in items)
                {
                    @Html.MyActonLink(item.Info, "Details", "Timetable", new { id = item.Id }, null);
                }
}
        </td>
        <td>
            @{
                items = Model.Where(i => i.DayOfWeek == 3 && i.StartTime >= tt && i.StartTime < tt + new TimeSpan(1, 0, 0));
                foreach (var item in items)
                {
                    @Html.MyActonLink(item.Info, "Details", "Timetable", new { id = item.Id }, null);
                }
}
        </td>
        <td>
            @{
                items = Model.Where(i => i.DayOfWeek == 4 && i.StartTime >= tt && i.StartTime < tt + new TimeSpan(1, 0, 0));
                foreach (var item in items)
                {
                    @Html.MyActonLink(item.Info, "Details", "Timetable", new { id = item.Id }, null);
                }
}
        </td>
        <td>
            @{
                items = Model.Where(i => i.DayOfWeek == 5 && i.StartTime >= tt && i.StartTime < tt + new TimeSpan(1, 0, 0));
                foreach (var item in items)
                {
                    @Html.MyActonLink(item.Info, "Details", "Timetable", new { id = item.Id }, null);
                }
}
        </td>
        <td>
            @{
                items = Model.Where(i => i.DayOfWeek == 6 && i.StartTime >= tt && i.StartTime < tt + new TimeSpan(1, 0, 0));
                foreach (var item in items)
                {
                    @Html.MyActonLink(item.Info, "Details", "Timetable", new { id = item.Id }, null);
                }
}
        </td>
        <td>
            @{
                items = Model.Where(i => i.DayOfWeek == 7 && i.StartTime >= tt && i.StartTime < tt + new TimeSpan(1, 0, 0));
                foreach (var item in items)
                {
                    @Html.MyActonLink(item.Info, "Details", "Timetable", new { id = item.Id }, null);
                }
}
        </td>
    </tr>
}

</table>
